const BASE_URL = 'http://127.0.0.1:3000/api/admin/conteudos'; // Confirmado porta 3000 via netstat
const WRONG_TOKEN = 'Bearer WRONG_SECRET_KEY';

async function testBruteForce() {
    console.log("\nğŸ’€ === INICIANDO SIMULAÃ‡ÃƒO DE ATAQUE DE BRUTE FORCE === ğŸ’€");
    console.log(`ğŸ¯ Alvo: ${BASE_URL}`);
    console.log("ğŸ”’ Objetivo: Testar proteÃ§Ã£o de Rate Limit e SeguranÃ§a da API\n");

    let blockedCount = 0;
    let passedCount = 0;

    for (let i = 1; i <= 10; i++) {
        // SimulaÃ§Ã£o visual de progresso
        process.stdout.write(`âš¡ Tentativa de invasÃ£o #${i}... `);

        try {
            const response = await fetch(BASE_URL, {
                headers: { 'Authorization': WRONG_TOKEN }
            });

            const status = response.status;

            if (status === 200) {
                console.log(`âŒ VULNERÃVEL! (Status 200 - Acesso Permitido)`);
                passedCount++;
            } else if (status === 429) {
                const data = await response.json().catch(() => ({}));
                console.log(`ğŸ›¡ï¸  BLOQUEADO (429 Rate Limit)`);
                console.log(`      â›” Mensagem do GuardiÃ£o: "${data.error || 'Sem mensagem'}"`);
                blockedCount++;
            } else if (status === 401) {
                console.log(`ğŸ”’ Negado (401 Auth) - Senha incorreta.`);
            } else if (status === 503) {
                console.log(`âš ï¸ Erro de ServiÃ§o (503) - Verifique conexÃµes.`);
            } else {
                console.log(`â“ Status: ${status}`);
            }

        } catch (error: any) {
            console.log(`âŒ Erro de conexÃ£o: ${error.message}`);
        }
        // Pequeno delay para efeito visual
        await new Promise(r => setTimeout(r, 200));
    }

    console.log("\nğŸ“Š === RELATÃ“RIO FINAL ===");
    console.log(`Tentativas Totais: 10`);
    console.log(`Ataques Bloqueados (Rate Limit): ${blockedCount}`);

    if (blockedCount > 0) {
        console.log(`âœ… SUCESSO: O sistema de defesa estÃ¡ ATIVO e BLOQUEANDO ataques massivos.`);
    } else {
        console.log(`âš ï¸ ALERTA: O Rate Limit nÃ£o foi ativado (ou tentativas foram insuficientes).`);
    }
    console.log("============================================================\n");
}

testBruteForce();
